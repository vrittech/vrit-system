{
    "sourceFile": "forms/tasks.py",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1731649483809,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1731649483809,
            "name": "Commit-0",
            "content": "from celery import shared_task\nfrom django.utils.timezone import now\nfrom .models import Forms\nimport logging\n\nlogger = logging.getLogger(__name__)\n\n@shared_task\ndef auto_expire_forms():\n    today = now().date()  # Get the current date\n    forms_to_expire = Forms.objects.filter(\n        auto_expiration=True,\n        auto_expiration_date__lte=today,\n        is_expired=False\n    )\n\n    expired_count = 0\n    for form in forms_to_expire:\n        try:\n            form.is_expired = True\n            form.is_show = False  # Optionally hide expired forms\n            form.save()\n            expired_count += 1\n        except Exception as e:\n            logger.error(f\"Failed to expire form ID {form.id}: {e}\")\n\n    logger.info(f\"Auto-expired {expired_count} forms.\")\n    return f\"Auto-expired {expired_count} forms.\"\n"
        }
    ]
}